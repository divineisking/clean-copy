{
  "version": 3,
  "sources": ["../src/engine/cleanText.js", "../src/clipboardAdapter.js", "../src/content.js"],
  "sourcesContent": ["\r\nconst INVISIBLE_FORMAT_CHARS =\r\n    /[\\u200B-\\u200D\\u2060\\uFEFF\\u034F]/g;\r\n\r\nconst BIDI_CONTROL_CHARS =\r\n    /[\\u202A-\\u202E\\u2066-\\u2069]/g;\r\n\r\nconst SOFT_LAYOUT_CHARS =\r\n    /[\\u00AD]/g;\r\n\r\nconst UNICODE_SPACES =\r\n    /[\\u00A0\\u1680\\u180E\\u2000-\\u200A\\u202F\\u205F\\u3000]/g;\r\n\r\nconst TAG_CHARS =\r\n    /[\\u{E0000}-\\u{E007F}]/gu;\r\n\r\nconst VARIATION_SELECTORS =\r\n    /[\\uFE00-\\uFE0F\\u{E0100}-\\u{E01EF}]/gu;\r\n\r\nfunction normalizeUnicode(text) {\r\n    return text.normalize(\"NFKC\");\r\n}\r\n\r\nfunction removeInvisibleChars(text) {\r\n    return text\r\n        .replace(INVISIBLE_FORMAT_CHARS, \"\")\r\n        .replace(BIDI_CONTROL_CHARS, \"\")\r\n        .replace(SOFT_LAYOUT_CHARS, \"\")\r\n        .replace(TAG_CHARS, \"\")\r\n        .replace(VARIATION_SELECTORS, \"\")\r\n        .replace(UNICODE_SPACES, \" \");\r\n}\r\n\r\nfunction normalizePunctuation(text) {\r\n    return text\r\n        .replace(/[\u201C\u201D]/g, '\"')\r\n        .replace(/[\u2018\u2019]/g, \"'\")\r\n        .replace(/\u2014/g, \" \")\r\n        .replace(/([\u2013\u2014-]){2,}/g, \" \");\r\n}\r\n\r\nfunction normalizeWhitespace(text) {\r\n    return text\r\n        .replace(/\\u00A0/g, \" \")\r\n        .replace(/\\r\\n/g, \"\\n\")\r\n        .replace(/\\s+/g, \" \")\r\n        .replace(/[ \\t]+$/gm, \"\")\r\n        .replace(/\\n{3,}/g, \"\\n\\n\")\r\n        .trim();\r\n}\r\n\r\n\r\nfunction cleanText(text) {\r\n    if (!text) return \"\";\r\n\r\n    return normalizeWhitespace(\r\n        normalizePunctuation(\r\n            removeInvisibleChars(\r\n                normalizeUnicode(text)\r\n            )\r\n        )\r\n    );\r\n}\r\n\r\n\r\nexport { cleanText };", "import { cleanText } from './engine/cleanText';\r\n\r\nlet enabled = true;\r\n\r\n/**\r\n * Safe chrome access (prevents test crashes)\r\n */\r\nfunction getChromeStorage() {\r\n  if (typeof chrome === 'undefined') return null;\r\n  if (!chrome.storage || !chrome.storage.sync) return null;\r\n  return chrome.storage.sync;\r\n}\r\n\r\n/**\r\n * Initialize enabled flag (runtime only)\r\n */\r\nconst storage = getChromeStorage();\r\nif (storage) {\r\n  storage.get(['enabled'], (res) => {\r\n    enabled = res.enabled !== false;\r\n  });\r\n\r\n  chrome.storage.onChanged.addListener((changes) => {\r\n    if (changes.enabled) {\r\n      enabled = changes.enabled.newValue;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * INSERTION HELPERS\r\n */\r\n\r\nfunction insertIntoInput(target, text) {\r\n  const start = target.selectionStart ?? target.value.length;\r\n  const end = target.selectionEnd ?? target.value.length;\r\n\r\n  target.value =\r\n    target.value.slice(0, start) +\r\n    text +\r\n    target.value.slice(end);\r\n\r\n  const cursor = start + text.length;\r\n  target.setSelectionRange(cursor, cursor);\r\n}\r\n\r\nfunction insertIntoContentEditable(text) {\r\n  const selection = window.getSelection();\r\n  if (!selection || selection.rangeCount === 0) return;\r\n\r\n  const range = selection.getRangeAt(0);\r\n\r\n  // Critical for the test: collapsed ranges must still insert\r\n  range.deleteContents();\r\n\r\n  const node = document.createTextNode(text);\r\n  range.insertNode(node);\r\n\r\n  range.setStartAfter(node);\r\n  range.setEndAfter(node);\r\n\r\n  selection.removeAllRanges();\r\n  selection.addRange(range);\r\n}\r\n\r\n/**\r\n * EVENT HANDLERS\r\n */\r\n\r\nfunction handlePaste(event) {\r\n  if (!enabled || !event.clipboardData) return;\r\n\r\n  event.preventDefault();\r\n\r\n  const rawText = event.clipboardData.getData('text/plain');\r\n  const cleaned = cleanText(rawText);\r\n  const target = event.target;\r\n\r\n  if (\r\n    target instanceof HTMLInputElement ||\r\n    target instanceof HTMLTextAreaElement\r\n  ) {\r\n    insertIntoInput(target, cleaned);\r\n    return;\r\n  }\r\n\r\n  // Prefer inserting at current DOM selection for contenteditable targets.\r\n  const selection = window.getSelection();\r\n  if (selection && selection.rangeCount > 0) {\r\n    insertIntoContentEditable(cleaned);\r\n    return;\r\n  }\r\n\r\n  // Fallback: if the target itself is contenteditable, insert there.\r\n  if (target.isContentEditable) {\r\n    insertIntoContentEditable(cleaned);\r\n  }\r\n}\r\n\r\nfunction handleCopy(event) {\r\n  if (!enabled || !event.clipboardData) return;\r\n\r\n  const target = event.target;\r\n\r\n  // INPUT / TEXTAREA\r\n  if (\r\n    target instanceof HTMLInputElement ||\r\n    target instanceof HTMLTextAreaElement\r\n  ) {\r\n    const start = target.selectionStart ?? 0;\r\n    const end = target.selectionEnd ?? 0;\r\n    if (start === end) return;\r\n\r\n    const rawText = target.value.slice(start, end);\r\n    const cleaned = cleanText(rawText);\r\n\r\n    event.clipboardData.setData('text/plain', cleaned);\r\n    event.preventDefault();\r\n    return;\r\n  }\r\n\r\n  // CONTENT / DOCUMENT SELECTION\r\n  const selection = window.getSelection();\r\n  if (!selection) return;\r\n\r\n  const rawText = selection.toString();\r\n  if (!rawText) return;\r\n\r\n  const cleaned = cleanText(rawText);\r\n\r\n  event.clipboardData.setData('text/plain', cleaned);\r\n  event.preventDefault();\r\n}\r\n\r\nfunction handleCut(event) {\r\n  if (!enabled || !event.clipboardData) return;\r\n\r\n  const target = event.target;\r\n\r\n  // INPUT / TEXTAREA\r\n  if (\r\n    target instanceof HTMLInputElement ||\r\n    target instanceof HTMLTextAreaElement\r\n  ) {\r\n    const start = target.selectionStart ?? 0;\r\n    const end = target.selectionEnd ?? 0;\r\n    if (start === end) return;\r\n\r\n    const rawText = target.value.slice(start, end);\r\n    const cleaned = cleanText(rawText);\r\n\r\n    event.clipboardData.setData('text/plain', cleaned);\r\n    target.value =\r\n      target.value.slice(0, start) +\r\n      target.value.slice(end);\r\n\r\n    target.setSelectionRange(start, start);\r\n    event.preventDefault();\r\n    return;\r\n  }\r\n\r\n  // CONTENTEDITABLE\r\n  const selection = window.getSelection();\r\n  if (!selection || selection.rangeCount === 0) return;\r\n\r\n  const range = selection.getRangeAt(0);\r\n  const rawText = selection.toString();\r\n  if (!rawText) return;\r\n\r\n  const cleaned = cleanText(rawText);\r\n\r\n  event.clipboardData.setData('text/plain', cleaned);\r\n  range.deleteContents();\r\n\r\n  event.preventDefault();\r\n}\r\n\r\n/**\r\n * PUBLIC API\r\n */\r\n\r\nexport function attachClipboardCleaner(root = document) {\r\n  root.addEventListener('paste', handlePaste);\r\n  root.addEventListener('copy', handleCopy);\r\n  root.addEventListener('cut', handleCut);\r\n}\r\n", "// content.js\r\nimport { attachClipboardCleaner } from './clipboardAdapter.js';\r\n\r\nattachClipboardCleaner();\r\n"],
  "mappings": "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",
  "names": ["rawText", "cleaned"]
}
